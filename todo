#!/usr/bin/env bash

declare -r TODO_ROOT="$HOME/.todo"
declare -r TASK_LIST="${TODO_ROOT}/tasks"

if [[ $# -eq 0 ]]; then
  echo "usage: todo <init|list|add|edit|remove|mark|unmark> [args]"
fi

if [[ $1 == 'init' ]]; then
  mkdir -p "$TODO_ROOT"
  touch "$TASK_LIST"
  echo "Initialized successfully"
fi

if [[ ! -f "$TASK_LIST" ]]; then
  echo "Please run 'todo init' before running '$1' command."
fi

if [[ $1 == 'list' ]]; then
  echo "# To be done"
  cat "$TASK_LIST"
  echo "# Completed"
  echo "Empty"
fi

if [[ $1 == 'add' ]]; then
  shift
  declare -r TASK_TITLE="$*"

  declare LAST_TASK_ID
  LAST_TASK_ID=$(tail -n1 "$TASK_LIST" | cut -d' ' -f1)
  declare -r LAST_TASK_ID

  declare -r TASK_ID=$(( LAST_TASK_ID + 1))
  echo "$TASK_ID $TASK_TITLE" >> "$TASK_LIST"
fi